<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>互动叙事实验</title>
  <link rel="stylesheet" href="./styles.css" />
  <script defer src="./app.js"></script>
  <script defer src="./story.js"></script>
  <script defer src="./lock.js"></script>
  <script defer src="./imagePuzzle.js"></script>
</head>
<body>
  <main class="app-shell">
    <header class="app-header">
      <h1>互动叙事实验</h1>
      <p class="hint-text">按剧情推进依次完成小游戏。</p>
      <button class="btn" id="btn-enter-story">进入剧情</button>
    </header>

    <!-- 故事模块：story.js 会直接 replaceChildren 这个容器 -->
    <section class="module-container" id="story-branch-container"></section>

    <!-- 密码锁模块：lock.js 需要这些 id -->
    <section class="module-container is-hidden" id="lock-game-container">
      <h2>解锁小游戏</h2>
      <div class="lock-controls">
        <input id="lock-input" placeholder="请输入 4 位数字" />
        <button class="btn" id="lock-submit">提交</button>
      </div>
      <p id="lock-hint" class="hint-text">请先输入密码。</p>

      <div id="story-controls">
        <button class="btn" id="branch-button" disabled>前往隐藏剧情</button>
      </div>

      <button class="btn" id="btn-back-from-lock">返回</button>
    </section>

    <!-- 图片拼图模块：imagePuzzle.js 需要这些 id -->
    <section class="module-container is-hidden" id="image-order-wrapper">
      <h2>事件线索重组</h2>
      <p class="hint-text">点击两张卡片交换位置，恢复事件顺序。</p>
      <div id="image-order-container"></div>
      <div id="puzzle-status" class="status">请选择两张图片进行交换。</div>
      <div id="story-state" class="story-state">当前章节：第 1 章（线索收集中）</div>

      <button class="btn" id="btn-back-from-image">返回</button>
    </section>
  </main>

  <script>
    // 用 main 的 app.js 做“页面模块切换”
    const { setModuleVisibility } = window.appStateApi || {};

    const showOnly = (which) => {
      setModuleVisibility?.("story-branch-container", which === "story");
      setModuleVisibility?.("lock-game-container", which === "lock");
      document.getElementById("image-order-wrapper")?.classList.toggle("is-hidden", which !== "image");
    };

    document.getElementById("btn-enter-story")?.addEventListener("click", () => showOnly("story"));
    document.getElementById("btn-back-from-lock")?.addEventListener("click", () => showOnly("story"));
    document.getElementById("btn-back-from-image")?.addEventListener("click", () => showOnly("story"));

    // 你也可以自己加按钮从故事跳到 lock/image（看你剧情怎么设计）
  </script>
</body>
</html>
